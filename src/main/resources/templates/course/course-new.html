<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org" lang="ko">
<head>
    <meta charset="UTF-8" />
    <title th:text="${mode == 'edit'} ? '강좌 수정' : '강좌 개설'">강좌</title>
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet" />
    <style>
        .img-preview{
            width:100%;
            max-width:360px;
            aspect-ratio:16/9;
            object-fit:cover;
            border:1px dashed #dee2e6;
            border-radius:.5rem;
            background:#f8f9fa;
        }
        .required::after{
            content:" *";
            color:#dc3545;
        }
    </style>
</head>
<body>
<div class="container py-4">
    <!-- 상단 헤더: 목록 + 제목 + 섹션 추가하기 버튼 -->
    <div class="d-flex align-items-center justify-content-between mb-3">
        <div class="d-flex align-items-center">
            <a href="/instructor/courses" class="btn btn-outline-secondary me-2">&larr; 목록</a>
            <h1 class="h4 mb-0" th:text="${mode == 'edit'} ? '강좌 수정' : '강좌 개설'">강좌</h1>
        </div>

        <!-- 섹션 추가하기 버튼 (URL은 이후 정책에 맞게 수정 가능) -->
        <a href="#"
           class="btn btn-outline-primary">
            섹션 추가하기
        </a>
    </div>

    <!-- create/edit 공용 폼 -->
    <form th:action="@{/instructor/courses}" th:object="${form}" method="post" class="needs-validation" novalidate>
        <!-- CSRF (Security 사용 시) -->
        <input type="hidden" th:if="${_csrf != null}" th:name="${_csrf.parameterName}" th:value="${_csrf.token}"/>

        <!-- edit일 때 PUT/PATCH 흉내 (스프링 MVC HiddenHttpMethodFilter 사용 시) -->
        <input type="hidden" name="_method" th:value="${mode == 'edit'} ? 'PUT' : 'POST'"/>

        <!-- edit일 때 id를 hidden으로 보낼지, URL path로만 처리할지 정책에 맞춰 둘 중 하나 선택 -->
        <!--<input type="hidden" th:if="${mode == 'edit'}" th:field="*{id}"/>-->

        <div class="row g-4">
            <div class="col-12 col-lg-7">
                <!-- 카테고리 -->
                <div class="mb-3">
                    <label for="categoryId" class="form-label required">카테고리</label>
                    <select id="categoryId" class="form-select" th:field="*{categoryId}" required>
                        <option value="" hidden>카테고리를 선택하세요</option>
                        <option th:each="c : ${categories}"
                                th:value="${c.id}"
                                th:text="${c.categoryName}">
                        </option>
                    </select>
                    <div class="invalid-feedback">카테고리를 선택해 주세요.</div>
                    <div class="text-danger small" th:if="${#fields.hasErrors('categoryId')}" th:errors="*{categoryId}"></div>
                </div>

                <!-- 제목 -->
                <div class="mb-3">
                    <label for="title" class="form-label required">강좌 제목</label>
                    <input id="title" type="text" class="form-control"
                           placeholder="예) 스프링 부트로 만드는 REST API"
                           th:field="*{title}" required maxlength="100"/>
                    <div class="invalid-feedback">제목을 입력해 주세요.</div>
                    <div class="text-danger small" th:if="${#fields.hasErrors('title')}" th:errors="*{title}"></div>
                </div>

                <!-- 설명 -->
                <div class="mb-3">
                    <label for="description" class="form-label">강좌 설명</label>
                    <textarea id="description" class="form-control" rows="6"
                              placeholder="강좌 개요, 수강 대상, 선행 지식 등을 적어 주세요."
                              maxlength="2000"
                              th:field="*{description}"></textarea>
                    <div class="text-danger small" th:if="${#fields.hasErrors('description')}" th:errors="*{description}"></div>
                </div>

                <!-- 포인트 -->
                <div class="mb-3">
                    <label for="pointAmount" class="form-label required">포인트</label>
                    <div class="input-group">
                        <input id="pointAmount" type="number" min="0" step="1" class="form-control"
                               placeholder="예) 10000" th:field="*{pointAmount}" required/>
                        <span class="input-group-text">P</span>
                    </div>
                    <div class="form-text">0이면 ‘무료’로 표시됩니다.</div>
                    <div class="invalid-feedback">포인트를 입력해 주세요.</div>
                    <div class="text-danger small" th:if="${#fields.hasErrors('pointAmount')}" th:errors="*{pointAmount}"></div>
                </div>

                <!-- 버튼 영역: 임시저장 / 게시하기 / 취소 -->
                <div class="d-flex flex-wrap gap-2 align-items-center">
                    <!-- 임시저장: 회색 아웃라인 -->
                    <button type="submit"
                            name="action"
                            value="DRAFT"
                            class="btn btn-outline-secondary">
                        임시저장
                    </button>

                    <!-- 게시하기: 신규는 초록, 수정은 파랑 -->
                    <button type="submit"
                            name="action"
                            value="PUBLISHED"
                            class="btn"
                            th:classappend="${mode == 'edit'} ? ' btn-primary' : ' btn-success'">
                        게시하기
                    </button>
                </div>
            </div>

            <!-- 우측 썸네일 -->
            <div class="col-12 col-lg-5">
                <div class="mb-2">
                    <label for="imageUrl" class="form-label">썸네일 이미지 URL</label>
                    <input id="imageUrl" type="url" class="form-control"
                           placeholder="https://example.com/thumbnail.jpg"
                           th:field="*{imageUrl}"/>
                    <div class="form-text">이미지 URL을 입력/수정하면 아래에 미리보기 됩니다.</div>
                    <div class="text-danger small" th:if="${#fields.hasErrors('imageUrl')}" th:errors="*{imageUrl}"></div>
                </div>

                <img id="preview" class="img-preview" alt="썸네일 미리보기"
                     th:src="*{imageUrl} != null ? *{imageUrl} :
                     'data:image/svg+xml;charset=UTF-8,%3Csvg xmlns=%27http://www.w3.org/2000/svg%27 width=%27640%27 height=%27360%27%3E%3Crect width=%27100%25%27 height=%27100%25%27 fill=%27%23f8f9fa%27/%3E%3Ctext x=%2750%25%27 y=%2750%25%27 dominant-baseline=%27middle%27 text-anchor=%27middle%27 fill=%27%236c757d%27 font-size=%2716%27%3E이미지 미리보기%3C/text%3E%3C/svg%3E'"/>
            </div>
        </div>
    </form>
</div>

<script>
    // 이미지 URL 입력 시 미리보기 업데이트
    const imageInput = document.getElementById('imageUrl');
    const preview = document.getElementById('preview');
    if (imageInput && preview) {
        imageInput.addEventListener('input', () => {
            const url = imageInput.value?.trim();
            if (!url) return;
            preview.src = url;
        });
    }
</script>
</body>
</html>